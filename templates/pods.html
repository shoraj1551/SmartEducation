{% extends "layouts/dashboard_base.html" %}

{% block title %}Accountability Pods | SmartEducation{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/pod-enhancements.css">
{% endblock %}

{% block content %}
<div class="pods-container">
    <div class="section-header">
        <h1>Accountability Pod</h1>
    </div>

    <!-- PENDING INVITES -->
    <div id="pendingArea" style="display:none; margin-bottom:2rem;">
        <div class="section-header">
            <h3>ğŸ”” Pending Invites</h3>
        </div>
        <div id="pendingList"></div>
    </div>

    <!-- ACTIVE POD -->
    <div class="pod-section">
        <div class="section-header">
            <h3>ğŸ‘¥ My Pod</h3>
            <span style="font-size:0.9rem; opacity:0.6;">Stay consistent together.</span>
        </div>
        <div id="podGrid" class="pod-grid">
            <div class="loading-spinner"><i class="fas fa-circle-notch fa-spin"></i> Loading pod...</div>
        </div>
    </div>

    <!-- INVITE -->
    <div class="pod-section">
        <div class="section-header">
            <h3>âœ‰ï¸ Invite Partner</h3>
        </div>
        <div class="invite-form">
            <input type="email" id="inviteEmail" class="invite-input" placeholder="friend@example.com">
            <button class="primary-btn nav-btn" onclick="sendInvite()">Send Invite</button>
        </div>
    </div>

    <!-- Shared Content Section -->
    <div class="pod-section">
        <div class="section-header">
            <h3>ğŸ“š Shared with Me</h3>
            <span style="font-size:0.9rem; opacity:0.6;">Content your friends are sharing</span>
        </div>
        <div id="sharedContent" class="shared-content-grid"
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
            <div style="text-align: center; padding: 2rem; opacity: 0.5; grid-column: 1/-1;">
                <i class="fas fa-circle-notch fa-spin"></i> Loading shared content...
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div class="modal" id="messageModal" style="display: none;">
        <div class="modal-card"
            style="max-width: 700px; max-height: 90vh; background: linear-gradient(135deg, rgba(30, 41, 59, 0.98) 0%, rgba(15, 23, 42, 0.98) 100%); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.15); border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
            <div style="display: flex; flex-direction: column; height: 600px;">
                <!-- Header -->
                <div
                    style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2);">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div id="messagePartnerAvatar"
                            style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.1rem; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                        </div>
                        <div>
                            <h3 id="messagePartnerName"
                                style="margin: 0; font-size: 1.3rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                                <i class="fas fa-comment"></i> Messages
                            </h3>
                            <div id="messagePartnerStatus"
                                style="font-size: 0.8rem; opacity: 0.6; margin-top: 0.25rem;">Online</div>
                        </div>
                    </div>
                    <button onclick="closeMessageModal()"
                        style="background: rgba(255,255,255,0.05); border: none; color: rgba(255,255,255,0.6); font-size: 1.25rem; cursor: pointer; padding: 0.5rem; border-radius: 8px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;"
                        onmouseover="this.style.background='rgba(239,68,68,0.2)'; this.style.color='#ef4444';"
                        onmouseout="this.style.background='rgba(255,255,255,0.05)'; this.style.color='rgba(255,255,255,0.6)';">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Message Thread -->
                <div id="messageThread"
                    style="flex: 1; overflow-y: auto; padding: 1.5rem; background: rgba(0,0,0,0.15); position: relative;">
                    <p style="text-align: center; opacity: 0.5; padding: 2rem;">No messages yet. Start the conversation!
                    </p>
                </div>

                <!-- Typing Indicator -->
                <div id="typingIndicator"
                    style="display: none; padding: 0.5rem 1.5rem; font-size: 0.85rem; opacity: 0.6; font-style: italic;">
                    <i class="fas fa-ellipsis-h fa-pulse"></i> Typing...
                </div>

                <!-- Input Area -->
                <div
                    style="padding: 1.5rem 2rem; border-top: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2);">
                    <div style="display: flex; gap: 0.75rem; align-items: flex-end;">
                        <div style="flex: 1; position: relative;">
                            <textarea id="messageInput" placeholder="Type your message..." rows="1"
                                style="width: 100%; padding: 1rem 1.25rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; outline: none; resize: none; font-family: inherit; font-size: 0.95rem; line-height: 1.5; max-height: 120px; transition: all 0.2s;"
                                onfocus="this.style.borderColor='#667eea'; this.style.background='rgba(255,255,255,0.08)';"
                                onblur="this.style.borderColor='rgba(255,255,255,0.1)'; this.style.background='rgba(255,255,255,0.05)';"
                                onkeydown="if(event.key==='Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"
                                oninput="autoResizeTextarea(this)"></textarea>
                            <div
                                style="position: absolute; bottom: 0.75rem; right: 0.75rem; font-size: 0.75rem; opacity: 0.4;">
                                Press Enter to send, Shift+Enter for new line
                            </div>
                        </div>
                        <button onclick="sendMessage()" id="sendMessageBtn" class="primary-btn nav-btn"
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 1rem 1.75rem; border-radius: 12px; display: flex; align-items: center; gap: 0.5rem; font-weight: 600; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); transition: all 0.2s;"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(102, 126, 234, 0.4)';"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.3)';">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </div>
                    <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem; font-size: 0.85rem; opacity: 0.5;">
                        <span id="messageCount">0 messages</span>
                        <span>â€¢</span>
                        <span id="lastMessageTime">Just now</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/pods.js"></script>
{% endblock %}